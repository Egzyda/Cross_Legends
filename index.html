<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cross Legends</title>
    <link rel="icon" href="img/bg/icon.png">
    <link rel="apple-touch-icon" href="img/bg/icon.png">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢ -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>
    </div>

    <div id="game-container">
        <!-- „Çø„Ç§„Éà„É´ÁîªÈù¢ -->
        <div id="title-screen" class="screen active">
            <h1>Cross Legends</h1>
            <p class="subtitle">Roguelite Game</p>

            <!-- Èõ£ÊòìÂ∫¶ÈÅ∏Êäû -->
            <div class="difficulty-selector">
                <label for="difficulty-select">Èõ£ÊòìÂ∫¶</label>
                <select id="difficulty-select" class="difficulty-dropdown">
                    <option value="0">0 - Âü∫Ê∫ñ</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10 - Ê•µÈôê</option>
                </select>
                <div id="difficulty-description" class="difficulty-description">
                    Ê®ôÊ∫ñÁöÑ„Å™Èõ£ÊòìÂ∫¶
                </div>
            </div>

            <button id="start-btn" class="btn-primary">GAME START</button>
            <button id="continue-btn" class="btn-primary" style="margin-top: 16px; display: none;">CONTINUE</button>
            <div class="title-sub-buttons">
                <button id="record-btn" class="btn-secondary">RECORD</button>
                <button id="howto-btn" class="btn-secondary">ÈÅä„Å≥Êñπ</button>
            </div>
        </div>

        <!-- „Éë„Éº„ÉÜ„Ç£Á∑®ÊàêÁîªÈù¢ -->
        <div id="party-screen" class="screen">
            <div class="party-header">
                <button id="back-to-home-btn" class="back-btn" onclick="game.backToHome()">‚Üê</button>
                <h2>„Éë„Éº„ÉÜ„Ç£Á∑®Êàê</h2>
            </div>
            <p class="description-text">Èï∑Êäº„Åó: Ë©≥Á¥∞„Çπ„ÉÜ„Éº„Çø„Çπ / „Çø„ÉÉ„Éó: Á∑®Êàê„ÉªËß£Èô§</p>
            <div id="party-tabs" class="tab-container"></div>
            <div id="character-list"></div>
            <div class="party-divider">
                <span>FORMATION</span>
            </div>
            <div id="party-slots">
                <div class="slot-column">
                    <span class="position-label">Â∑¶ÔºàÂâçË°õÔºâ</span>
                    <div class="party-slot" data-position="left">
                        <div class="slot-content"></div>
                    </div>
                </div>
                <div class="slot-column">
                    <span class="position-label">‰∏≠Â§Æ</span>
                    <div class="party-slot" data-position="center">
                        <div class="slot-content"></div>
                    </div>
                </div>
                <div class="slot-column">
                    <span class="position-label">Âè≥ÔºàÂæåË°õÔºâ</span>
                    <div class="party-slot" data-position="right">
                        <div class="slot-content"></div>
                    </div>
                </div>
            </div>
            <div class="name-input-container">
                <label for="player-name-input" class="name-input-label">PLAYER NAME</label>
                <input type="text" id="player-name-input" class="name-input" placeholder="ENTER NAME" maxlength="12">
            </div>
            <button id="start-run-btn" class="btn-primary" disabled>ÂÜíÈô∫ÈñãÂßã</button>
        </div>

        <!-- „Éé„Éº„Éâ„Éû„ÉÉ„ÉóÁîªÈù¢ -->
        <div id="map-screen" class="screen">
            <div id="map-header">
                <span id="act-display">Á¨¨1Âπï</span>
                <span id="node-progress">0/10</span>
            </div>
            <div id="node-map"></div>
            <div id="party-status-bar"></div>
        </div>

        <!-- Êà¶ÈóòÁîªÈù¢ -->
        <div id="battle-screen" class="screen">
            <div id="enemy-area"></div>
            <div id="ally-area"></div>
            <div id="battle-log"></div>
            <div id="command-area">
                <div id="character-commands"></div>
                <div id="action-buttons">
                    <button class="action-btn" data-action="attack">ÊîªÊíÉ</button>
                    <button class="action-btn" data-action="skill">„Çπ„Ç≠„É´</button>
                    <button class="action-btn" data-action="defend">Èò≤Âæ°</button>
                    <button class="action-btn" data-action="item">„Ç¢„Ç§„ÉÜ„É†</button>
                    <button class="action-btn" id="back-btn">Êàª„Çã</button>
                    <button id="execute-turn-btn" class="action-btn hidden">„Çø„Éº„É≥ÈñãÂßã</button>
                </div>
                <div id="target-selection" class="hidden"></div>
                <div id="skill-selection" class="hidden"></div>
                <div id="item-selection" class="hidden"></div>
            </div>

        </div>

        <!-- Â†±ÈÖ¨ÈÅ∏ÊäûÁîªÈù¢ -->
        <div id="reward-screen" class="screen">
            <h2>Â†±ÈÖ¨ÈÅ∏Êäû</h2>
            <div id="reward-party-status"></div>
            <div id="reward-character-name"></div>
            <div id="reward-sp-info"></div>
            <div id="reward-options"></div>
        </div>

        <!-- ‰ºëÊÜ©ÁîªÈù¢ -->
        <div id="rest-screen" class="screen">
            <h2>üî• ‰ºëÊÜ©</h2>
            <div id="rest-party-status"></div>
            <div id="rest-options">
                <button class="rest-btn" data-type="hp">HP 40%ÂõûÂæ©</button>
                <button class="rest-btn" data-type="mp">MP 40%ÂõûÂæ©</button>
                <button class="rest-btn" data-type="both">HP„ÉªMP ‰∏°Êñπ20%ÂõûÂæ©</button>
            </div>
        </div>

        <!-- „Ç§„Éô„É≥„ÉàÁîªÈù¢ -->
        <div id="event-screen" class="screen">
            <h2 id="event-title"></h2>
            <p id="event-description"></p>
            <div id="event-options"></div>
            <div id="event-party-status"></div>
            <div id="event-gold-display" class="event-gold">ÊâÄÊåÅÈáë: 0ÂÜÜ</div>
        </div>

        <!-- „Ç∑„Éß„ÉÉ„ÉóÁîªÈù¢ -->
        <div id="shop-screen" class="screen">
            <div class="shop-header-row">
                <h2>ÈóáÂïÜ‰∫∫</h2>
                <div id="shop-gold-display">ÊâÄÊåÅÈáë: 0ÂÜÜ</div>
            </div>
            <div id="shop-container"></div>
            <button id="leave-shop-btn" class="btn-primary" style="margin-top:20px;">Â∫ó„ÇíÂá∫„Çã</button>
        </div>



        <!-- Game Over Modal (Rich Overlay) -->
        <div id="gameover-modal" class="gameover-overlay hidden">
            <div class="gameover-content">
                <h2 class="gameover-title">GAME OVER</h2>
                <div class="gameover-divider"></div>
                <p class="gameover-message">ÂÖ®ÊªÖ„Åó„Å¶„Åó„Åæ„Å£„Åü...</p>
                <div class="gameover-actions">
                    <button id="retry-btn-modal" class="btn-ghost">„Çø„Ç§„Éà„É´„Å∏Êàª„Çã</button>
                </div>
            </div>
        </div>

        <!-- Victory Modal (Rich Overlay) -->
        <div id="victory-modal" class="victory-overlay hidden">
            <div class="victory-content">
                <h2 class="victory-title">VICTORY!</h2>
                <div class="victory-divider"></div>
                <p class="victory-message">„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ<br>‰∏ñÁïå„ÅØÊïë„Çè„Çå„Åæ„Åó„Åü„ÄÇ</p>
                <div class="victory-actions">
                    <button id="victory-btn-modal" class="btn-victory">„Çø„Ç§„Éà„É´„Å∏Êàª„Çã</button>
                </div>
            </div>
        </div>

        <!-- Custom Modal -->
        <div id="custom-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3 id="modal-title"></h3>
                <div id="modal-body"></div>
                <div id="modal-actions"></div>
            </div>
        </div>

        <!-- Character Detail Modal -->
        <div id="character-detail-modal" class="modal-overlay hidden">
            <div class="modal-content character-detail">
                <div class="detail-header">
                    <h3 id="detail-char-name"></h3>
                    <button class="close-btn" onclick="game.closeCharacterDetail()">√ó</button>
                </div>
                <div id="detail-body"></div>
            </div>
        </div>

        <!-- Item Modal -->
        <div id="item-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>ÊâÄÊåÅ„Ç¢„Ç§„ÉÜ„É†</h3>
                <div id="item-list"></div>
                <button class="btn-primary" onclick="game.closeItemModal()">Èñâ„Åò„Çã</button>
            </div>
        </div>

        <!-- Character Select Modal -->
        <div id="character-select-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3 id="select-modal-title">„Ç≠„É£„É©„ÇØ„Çø„ÉºÈÅ∏Êäû</h3>
                <div id="character-select-grid" class="item-swap-grid"></div>
                <button class="btn-primary" id="character-select-cancel-btn">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>

        <!-- How to Play Modal -->
        <div id="howto-modal" class="modal-overlay hidden">
            <div class="modal-content howto-modal-content">
                <h3>ÈÅä„Å≥Êñπ</h3>
                <div id="howto-content" class="howto-content"></div>
                <button class="btn-primary" onclick="game.closeHowtoModal()">Èñâ„Åò„Çã</button>
            </div>
        </div>

        <!-- Records Modal -->
        <div id="records-modal" class="modal-overlay hidden">
            <div class="modal-content records-modal-content">
                <h3>OFFICIAL RECORDS</h3>
                <div class="records-header">
                    <span>Rank / Player</span>
                    <span>Date</span>
                </div>
                <div id="records-list" class="records-list">
                    <!-- Records will be injected here -->
                    <div class="loading-records">Loading...</div>
                </div>
                <button class="btn-primary" onclick="game.closeRecordsModal()">Èñâ„Åò„Çã</button>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toast-container"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="firebase_manager.js"></script>
    <script src="data.js"></script>
    <script src="data_allies.js"></script>
    <script src="data_enemies.js"></script>
    <script src="game.js"></script>
</body>

</html>