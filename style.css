@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&family=Noto+Sans+JP:wght@400;700&display=swap');

:root {
    --primary: #4facfe;
    --primary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --bg-dark: #0b0c15;
    --bg-panel: rgba(255, 255, 255, 0.05);
    --glass-border: rgba(255, 255, 255, 0.1);
    --text-main: #ffffff;
    --text-sub: #a0a0b0;
    --danger: #ff6b6b;
    --success: #4ecdc4;
    --warning: #f5af19;
    --shadow-glow: 0 0 15px rgba(79, 172, 254, 0.3);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Outfit', 'Noto Sans JP', sans-serif;
    background-color: var(--bg-dark);
    color: var(--text-main);
    height: 100vh;
    overflow: hidden;
    user-select: none;
    -webkit-user-select: none;
}

/* 繝ｭ繝ｼ繝�ぅ繝ｳ繧ｰ逕ｻ髱｢ */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.loading-overlay.hidden {
    display: none;
}

.loading-content {
    text-align: center;
    color: var(--text-main);
}

.loading-content p {
    margin-top: 16px;
    font-size: 14px;
    color: var(--text-sub);
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(79, 172, 254, 0.2);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

#game-container {
    max-width: 430px;
    margin: 0 auto;
    height: 100dvh;
    position: relative;
    display: flex;
    flex-direction: column;
    background: rgba(11, 12, 21, 0.8);
    backdrop-filter: blur(20px);
    box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
}

.screen {
    display: none;
    padding: 24px;
    height: 100%;
    overflow: hidden;
    animation: fadeIn 0.4s ease-out;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
}

.screen::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    /* Overlay to ensure text readability */
    z-index: 0;
}

.screen>* {
    position: relative;
    z-index: 1;
}

.screen.active {
    display: flex;
    flex-direction: column;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.hidden {
    display: none !important;
}

/* Typography */
h1,
h2,
h3 {
    font-weight: 700;
    letter-spacing: 0.05em;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

/* Buttons */
.btn-primary {
    background: var(--primary-gradient);
    border: none;
    color: #fff;
    padding: 16px 32px;
    font-size: 16px;
    font-weight: 700;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow: 0 10px 20px -5px rgba(79, 172, 254, 0.4);
    position: relative;
    overflow: hidden;
}

.btn-primary::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(rgba(255, 255, 255, 0.2), transparent);
    opacity: 0;
    transition: 0.3s;
}

.btn-primary:active {
    transform: scale(0.96);
}

.btn-primary:disabled {
    background: #333;
    box-shadow: none;
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-danger {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5253 100%);
    border: none;
    color: #fff;
    padding: 16px 32px;
    font-size: 16px;
    font-weight: 700;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 10px 20px -5px rgba(255, 107, 107, 0.4);
}

.btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 15px 25px -5px rgba(255, 107, 107, 0.6);
}

/* Title Screen */
#title-screen {
    justify-content: center;
    align-items: center;
    text-align: center;
    background-image: url('img/bg/bg_title.png');
}

#title-screen h1 {
    font-size: clamp(32px, 11vw, 48px);
    white-space: nowrap;
    /* Slightly larger */
    margin-bottom: 24px;
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    /* Restore gradient var if needed, or keeping similar */
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 15px rgba(79, 172, 254, 0.6)) drop-shadow(0 0 30px rgba(79, 172, 254, 0.4));
    animation: title-gradient 3s ease infinite;
}

@keyframes title-gradient {
    0% {
        background-position: 0% 50%;
    }

    50% {
        background-position: 100% 50%;
    }

    100% {
        background-position: 0% 50%;
    }
}

#title-screen .btn-primary,
#title-screen .btn-danger {
    width: 240px;
    /* Fixed width for consistency */
    display: block;
    /* Stack vertically */
    margin: 0 auto;
    /* Center */
}

#continue-btn {
    margin-top: 16px;
}

#title-screen .subtitle {
    font-size: 14px;
    color: var(--text-sub);
    margin-bottom: 60px;
    text-transform: uppercase;
    letter-spacing: 0.2em;
}

/* Party Screen */
#party-screen {
    padding-bottom: 30px;
    height: 100%;
}

#party-screen h2 {
    text-align: center;
    margin-bottom: 24px;
    margin-bottom: 24px;
    font-size: 24px;
}

.description-text {
    text-align: center;
    font-size: 12px;
    color: var(--text-sub);
    margin-bottom: 12px;
}

/* Filter Dropdown */
.filter-container {
    margin-bottom: 16px;
    padding: 0 8px;
}

#party-filter {
    width: 100%;
    padding: 12px;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    color: #fff;
    font-size: 16px;
    font-family: inherit;
    outline: none;
}

#character-list {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    overflow-y: auto;
    padding: 4px;
    flex: 1;
    scrollbar-width: none;
    -ms-overflow-style: none;
    align-content: start;
}

#character-list::-webkit-scrollbar {
    display: none;
}

.character-card {
    background: #444;
    /* Solid gray */
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 12px 8px;
    text-align: center;
    transition: all 0.2s;
    position: relative;
    cursor: pointer;
}

.character-card.selecting {
    background: #556;
    /* Slightly lighter solid for selection state */
    border-color: var(--primary);
    box-shadow: 0 0 20px rgba(79, 172, 254, 0.4);
    transform: scale(1.05);
}

.character-card.selected {
    background: #4a5a6a;
    /* Distinct solid color for in-party */
    border-color: var(--primary);
    box-shadow: 0 0 15px rgba(79, 172, 254, 0.2);
}

.character-card img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid transparent;
    margin-bottom: 8px;
    background: #222;
}

.character-card.selected img {
    border-color: var(--primary);
}

.character-card .char-type-label {
    font-size: 8px;
    color: var(--primary);
    margin-bottom: 2px;
    font-weight: 700;
}

.character-card .char-name {
    font-size: 10px;
    font-weight: 700;
    line-height: 1.2;
    height: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    overflow: visible;
    white-space: nowrap;
}

.character-card .char-type {
    font-size: 10px;
    color: var(--text-sub);
}

/* Party Divider */
.party-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 16px 0 12px;
    position: relative;
    width: 100%;
}

.party-divider::before,
.party-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(255, 255, 255, 0.2);
}

.party-divider span {
    padding: 0 12px;
    font-size: 10px;
    color: var(--text-sub);
    letter-spacing: 0.1em;
    font-weight: 700;
}

#party-slots {
    display: flex;
    gap: 12px;
    margin-bottom: 12px;
    flex-shrink: 0;
    justify-content: center;
}

.slot-column {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.party-slot {
    width: 80px;
    height: 105px;
    background: linear-gradient(145deg, #2b3a4a, #222e3b);
    border: 1px dashed #556c80;
    border-radius: 12px;
    padding: 8px 4px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    cursor: pointer;
    transition: all 0.2s;
    flex: 0 0 auto;
    position: relative;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

.party-slot.available {
    border-color: var(--primary);
    background: linear-gradient(145deg, #3a4b5d, #2f3e4d);
    box-shadow: 0 0 15px rgba(79, 172, 254, 0.25);
}

.party-slot.filled {
    border-style: solid;
    border-color: var(--primary);
    background: linear-gradient(145deg, #34495e, #2c3e50);
}

.slot-content {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
}

.slot-role-label {
    font-size: 8px;
    color: var(--primary);
    margin-bottom: 2px;
    font-weight: 700;
}

.slot-char-name {
    font-size: 10px;
    font-weight: 700;
    line-height: 1.2;
    height: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    overflow: visible;
    white-space: nowrap;
    margin-top: auto;
    /* Push to bottom if needed, or just let flow */
    margin-bottom: 4px;
}

/* Position label is now outside, update margin */
.position-label {
    font-size: 10px;
    color: var(--text-sub);
    margin-bottom: 6px;
    text-transform: uppercase;
    font-weight: 700;
}

/* Note: Party screen shares generic bg or title bg if needed, or keeping transparent/dark */
#party-screen {
    background-image: url('img/bg/bg_title.png');
    /* Reuse title or generic */
}

/* Map Screen */
#map-screen {
    background-image: url('img/bg/bg_map.png');
}

#map-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 16px;
    border: 1px solid var(--glass-border);
    margin-bottom: 16px;
    font-weight: 700;
}

#node-map {
    flex: 1;
    display: flex;
    flex-direction: column;
    /* 荳翫°繧我ｸ九∈隕∫ｴ�霑ｽ蜉���ame.js縺ｧ蛻ｶ蠕｡�� */
    align-items: center;
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 40px 20px;
    scroll-behavior: smooth;
}

/* Branching Map Container within #node-map */
.layers-container {
    display: flex;
    flex-direction: column;
    gap: 40px;
    /* 髫主ｱ､髢薙�霍晞屬 */
    width: 100%;
    z-index: 1;
    /* SVG繧医ｊ荳� */
}

/* 蜷�嚴螻､縺ｮ陦� */
.map-layer-row {
    display: flex;
    justify-content: center;
    /* 荳ｭ螟ｮ謠�∴ */
    align-items: center;
    width: 100%;
    position: relative;
    height: 60px;
    /* 繝弱�繝峨�鬮倥＆遒ｺ菫� */
}

.map-node {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    background: var(--bg-panel);
    border: 2px solid var(--glass-border);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: absolute;
    /* absolute驟咲ｽｮ縺ｧ蛻�ｸ�＆縺帙ｋ */
    /* 縺励°縺庸lexbox縺ｧ荳ｦ縺ｹ縺溘＞縲Ｂbsolute縺�縺ｨ謗･邯夂ｷ壽緒逕ｻ縺ｯ讌ｽ縺�縺後Ξ繧ｹ繝昴Φ繧ｷ繝悶′髱｢蛟偵�
       game.js縺ｮ謠冗判繝ｭ繧ｸ繝�け縺ｧ縺ｯ蜊倥↓ div 繧定ｿｽ蜉�縺励※縺�ｋ縺�縺代↑縺ｮ縺ｧ縲�
       縺薙％縺ｧ縺ｯ flexbox 縺ｧ蝮�ｭ蛾�鄂ｮ縺吶ｋ繧｢繝励Ο繝ｼ繝√ｒ縺ｨ繧九� */
    position: relative;
    margin: 0 15px;
    /* 繝弱�繝蛾俣縺ｮ譛蟆上�繝ｼ繧ｸ繝ｳ */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    z-index: 2;
}

/* 繝弱�繝峨ち繧､繝怜挨繧ｹ繧ｿ繧､繝ｫ */
.node-type-battle {
    background: radial-gradient(circle, #333, #111);
    border-color: #666;
}

.node-type-elite {
    background: radial-gradient(circle, #5a1a1a, #2a0a0a);
    border-color: #ff4444;
}

.node-type-rest {
    background: radial-gradient(circle, #5a4a1a, #2a1a0a);
    border-color: #ffaa44;
}

.node-type-event {
    background: radial-gradient(circle, #1a3a5a, #0a1a2a);
    border-color: #44aaff;
}

.node-type-treasure {
    background: radial-gradient(circle, #5a5a1a, #2a2a0a);
    border-color: #ffff44;
}

.node-type-boss {
    width: 80px !important;
    height: 80px !important;
    font-size: 40px !important;
    background: radial-gradient(circle, #4a0a4a, #2a0a2a);
    border-color: #ff44ff;
    box-shadow: 0 0 20px rgba(255, 0, 255, 0.4);
}

/* 迥ｶ諷句挨繧ｹ繧ｿ繧､繝ｫ */
.map-node.available {
    border-color: #ffd700;
    cursor: pointer;
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    animation: pulseGold 1.5s infinite;
}

.map-node.available:hover {
    transform: scale(1.2);
}

.map-node.completed {
    filter: grayscale(100%);
    opacity: 0.6;
    border-style: dashed;
}

.map-node.locked {
    opacity: 0.4;
    filter: brightness(0.7);
}

@keyframes pulseGold {
    0% {
        box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
    }

    70% {
        box-shadow: 0 0 0 10px rgba(255, 215, 0, 0);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(255, 215, 0, 0);
    }
}

#party-status-bar {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 12px;
    display: flex;
    flex-direction: column;
    /* Vertical layout */
    gap: 8px;
    border-top: 1px solid var(--glass-border);
    position: relative;
}

.controls-row {
    display: flex;
    justify-content: flex-end;
    width: 100%;
}

.members-row {
    display: flex;
    gap: 8px;
    width: 100%;
}

#item-btn {
    /* Removed absolute positioning */
    background: rgba(79, 172, 254, 0.2);
    border: 1px solid var(--primary);
    color: #fff;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    cursor: pointer;
    transition: 0.2s;
}

#item-btn:hover {
    background: rgba(79, 172, 254, 0.4);
}

#home-btn {
    background: rgba(78, 205, 196, 0.2);
    border: 1px solid var(--success);
    color: #fff;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    cursor: pointer;
    transition: 0.2s;
    margin-right: 8px;
}

#home-btn:hover {
    background: rgba(78, 205, 196, 0.4);
}

.party-member-status {
    flex: 1;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    padding: 4px;
    border-radius: 8px;
    transition: 0.2s;
}

.party-member-status:hover {
    background: rgba(255, 255, 255, 0.05);
}

.party-member-status img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid var(--glass-border);
    background: #222;
}

.party-member-status .hp-mp-text {
    font-size: 10px;
    color: var(--text-sub);
}

.party-member-status .name {
    font-size: 11px;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Battle Screen */
#battle-screen {
    padding: 12px 16px 0 16px;
    /* 上の余白を少し詰め、下はコマンドエリアに任せる */
    gap: 8px;
    /* 要素間の隙間を少し詰める */
    background-image: url('img/bg/bg_battle.png');
}

#battle-log {
    height: 56px;
    /* 約3行分に固定 */
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    padding: 4px 8px;
    overflow-y: auto;
    font-size: 11px;
    /* 文字を少し小さくして3行入りやすくする */
    margin-bottom: 4px;
    scrollbar-width: thin;
    flex-shrink: 0;
    /* ログが潰されないように保護 */
}

#enemy-area {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    min-height: 130px;
}

/* VS Divider */
.vs-divider {
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    margin: 4px 0;
}

.vs-divider::before,
.vs-divider::after {
    content: '';
    flex: 1;
    height: 2px;
    background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3), transparent);
}

.vs-divider span {
    padding: 0 16px;
    font-size: 16px;
    font-weight: 900;
    color: #ffd700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    letter-spacing: 0.2em;
}

#ally-area {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    min-height: 115px;
}

.battle-unit {
    position: relative;
    transition: transform 0.2s;
    width: 100px;
    /* Wider for name */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;

    /* Card-like styling */
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid var(--glass-border);
    border-radius: 8px;
    padding: 4px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

/* Enemy/Ally Distinction */
.battle-unit[data-enemy-index] {
    background: linear-gradient(145deg, rgba(80, 20, 20, 0.7), rgba(40, 10, 10, 0.7));
    border-color: #ff6b6b;
}

.battle-unit[data-ally-index] {
    background: linear-gradient(145deg, rgba(20, 40, 80, 0.7), rgba(10, 20, 40, 0.7));
    border-color: #4facfe;
}

.battle-unit img {
    width: 80px;
    height: 80px;
    border-radius: 6px;
    object-fit: cover;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);

    /* Rich Frame for Image */
    border: 2px solid #aaa;
}

.unit-name {
    font-size: 10px;
    /* Smaller text */
    margin-top: 4px;
    white-space: nowrap;
    /* Prevent wrapping if possible, or allow it but with smaller font */
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    text-align: center;
    color: #fff;
    text-shadow: 0 1px 2px #000;
}

.battle-unit.selected img {
    border-color: var(--warning);
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(245, 175, 25, 0.3);
}

.battle-unit.target img {
    border-color: var(--danger);
    animation: shake 0.4s;
}

@keyframes shake {

    0%,
    100% {
        transform: translateX(0);
    }

    25% {
        transform: translateX(-4px);
    }

    75% {
        transform: translateX(4px);
    }
}

.battle-unit.dead {
    opacity: 0.5;
    filter: grayscale(1);
    transform: scale(0.9);
}

/* Battle Effects */
.battle-impact-effect {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 120px;
    pointer-events: none;
    z-index: 100;
    animation: impactPulse 0.3s ease-out;
}

.battle-impact-effect img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

@keyframes impactPulse {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    50% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 0;
    }
}

/* Flash Effects */
.flash-white {
    animation: flashWhite 0.3s ease-out;
}

.flash-yellow {
    animation: flashYellow 0.3s ease-out;
}

.flash-blue {
    animation: flashBlue 0.3s ease-out;
}

.flash-red {
    animation: flashRed 0.3s ease-out;
}

.flash-purple {
    animation: flashPurple 0.3s ease-out;
}

.flash-green {
    animation: flashGreen 0.3s ease-out;
}

.flash-gold {
    animation: flashGold 0.3s ease-out;
}

@keyframes flashWhite {

    0%,
    100% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(3) drop-shadow(0 0 10px #fff);
    }
}

@keyframes flashYellow {

    0%,
    100% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(2.5) drop-shadow(0 0 15px #ffd700);
    }
}

@keyframes flashBlue {

    0%,
    100% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(2.5) drop-shadow(0 0 15px #4facfe);
    }
}

@keyframes flashRed {

    0%,
    100% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(2.5) drop-shadow(0 0 15px #ff6b6b);
    }
}

@keyframes flashPurple {

    0%,
    100% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(2.5) drop-shadow(0 0 15px #a29bfe);
    }
}

@keyframes flashGreen {

    0%,
    100% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(2.5) drop-shadow(0 0 15px #4ecdc4);
    }
}

@keyframes flashGold {

    0%,
    100% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(2.5) drop-shadow(0 0 20px #ffd700);
    }
}

/* Buff/Debuff Effect Icons */
.effect-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    font-weight: 900;
    pointer-events: none;
    z-index: 100;
    text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
}

.effect-icon.buff-up {
    color: #ff6b6b;
    animation: buffUp 0.6s ease-out;
}

.effect-icon.debuff-down {
    color: #4facfe;
    animation: debuffDown 0.6s ease-out;
}

.effect-icon.heal {
    color: #4ecdc4;
    animation: healPulse 0.6s ease-out;
}

.effect-icon.revive {
    color: #ffd700;
    animation: reviveSpin 0.8s ease-out;
}

.effect-icon.shield {
    color: #c0c0c0;
    animation: shieldFade 0.5s ease-out;
}

.effect-icon.status {
    animation: statusBlink 0.6s ease-out;
}

@keyframes buffUp {
    0% {
        transform: translate(-50%, 20%);
        opacity: 0;
    }

    50% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -80%);
        opacity: 0;
    }
}

@keyframes debuffDown {
    0% {
        transform: translate(-50%, -80%);
        opacity: 0;
    }

    50% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, 20%);
        opacity: 0;
    }
}

@keyframes healPulse {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    50% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
    }
}

@keyframes reviveSpin {
    0% {
        transform: translate(-50%, -50%) scale(0.5) rotate(0deg);
        opacity: 0;
    }

    50% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(1.5) rotate(360deg);
        opacity: 0;
    }
}

@keyframes shieldFade {
    0% {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
    }
}

@keyframes statusBlink {

    0%,
    100% {
        opacity: 0;
    }

    25%,
    75% {
        opacity: 1;
    }

    50% {
        opacity: 0;
    }
}

/* Critical Effect */
.critical-text {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 64px;
    font-weight: 900;
    color: #ffd700;
    text-shadow:
        0 0 10px #000,
        0 0 20px #ffd700,
        0 0 30px #ffd700;
    pointer-events: none;
    z-index: 200;
    animation: criticalPop 0.6s ease-out;
}

@keyframes criticalPop {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    30% {
        transform: translate(-50%, -50%) scale(1.3);
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
    }
}

/* Screen Flash for Critical */
.screen-flash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 150;
    animation: screenFlash 0.4s ease-out;
}

.screen-flash.flash-critical {
    background: radial-gradient(circle, rgba(255, 215, 0, 0.4) 0%, transparent 70%);
}

@keyframes screenFlash {

    0%,
    100% {
        opacity: 0;
    }

    50% {
        opacity: 1;
    }
}

/* Bars */
.unit-hp-bar,
.unit-mp-bar,
.hp-bar,
.mp-bar {
    width: 100%;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
}

.unit-hp-bar {
    height: 14px;
    /* Increased from 6px */
    margin-top: 6px;
    position: relative;
}

.unit-mp-bar {
    height: 12px;
    /* Increased from 4px */
    margin-top: 3px;
    position: relative;
}

.bar-text {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 9px;
    color: #fff;
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    line-height: 1;
    z-index: 2;
}

.hp-bar {
    height: 6px;
    margin: 3px 0;
}

.mp-bar {
    height: 4px;
}

.fill {
    height: 100%;
    transition: width 1.0s cubic-bezier(0.22, 1, 0.36, 1);
    /* 1秒かけた滑らかな減少 */
}

/* 状態異常バッジの配色設定 */
.status-ailment.poison {
    background: #a333c8;
    color: #fff;
}

.status-ailment.paralysis,
.status-ailment.stun {
    background: #fbbd08;
    color: #000;
}

.status-ailment.silence {
    background: #1b1c1d;
    color: #fff;
}

.status-ailment.burn {
    background: #db2828;
    color: #fff;
}

.status-ailment.taunt {
    background: #f5af19;
    color: #000;
}

.status-ailment.defending {
    background: #2185d0;
    color: #fff;
}

.status-ailment.regen {
    background: #21ba45;
    color: #fff;
}

.status-ailment.damageReduction {
    background: #2c3e50;
    color: #fff;
}

/* 防御：洗練されたシールドエフェクト */
.shield-aura {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 120px;
    border: 4px solid #4facfe;
    border-radius: 50%;
    background: rgba(79, 172, 254, 0.2);
    box-shadow: 0 0 20px #4facfe, inset 0 0 20px #4facfe;
    pointer-events: none;
    z-index: 100;
    animation: shield-expand-fade 0.8s ease-out forwards;
}

@keyframes shield-expand-fade {
    0% {
        transform: translate(-50%, -50%) scale(0.6);
        opacity: 0;
    }

    20% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(1.4);
        opacity: 0;
    }
}

/* ダメージポップアップのバネ挙動 */
.damage-popup {
    position: absolute;
    font-weight: 900;
    font-size: 28px;
    color: #ff6b6b;
    text-shadow: 0 2px 4px #000;
    animation: spring-up 1.0s forwards;
    z-index: 200;
}

.damage-popup.critical {
    color: #ffd700;
    font-size: 36px;
    text-shadow: 0 0 10px #ff0000, 0 2px 4px #000;
}

@keyframes spring-up {
    0% {
        transform: translateY(0) scale(0.5);
        opacity: 0;
    }

    20% {
        transform: translateY(-30px) scale(1.2);
        opacity: 1;
    }

    40% {
        transform: translateY(-25px) scale(0.9);
    }

    60% {
        transform: translateY(-28px) scale(1.0);
    }

    100% {
        transform: translateY(-60px);
        opacity: 0;
    }
}

.unit-hp-bar .fill,
.hp-bar .fill {
    background: var(--secondary-gradient);
}

.unit-mp-bar .fill,
.mp-bar .fill {
    background: var(--primary-gradient);
}

/* 繝舌ヵ/繝�ヰ繝輔が繝ｼ繝舌�繝ｬ繧､�育判蜒丞ｷｦ荳翫↓驥阪�縺ｦ陦ｨ遉ｺ�� */
.buff-overlay {
    position: absolute;
    top: 4px;
    left: 4px;
    display: flex;
    flex-direction: column;
    gap: 2px;
    z-index: 10;
    pointer-events: none;
}

.buff-item,
.debuff-item {
    font-size: 10px;
    font-weight: 700;
    padding: 2px 4px;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.8);
    white-space: nowrap;
}

.buff-item {
    color: #ff6b6b;
    border: 1px solid rgba(255, 107, 107, 0.5);
}

.debuff-item {
    color: #4facfe;
    border: 1px solid rgba(79, 172, 254, 0.5);
}

/* 迥ｶ諷狗焚蟶ｸ陦ｨ遉ｺ�医く繝｣繝ｩ荳矩Κ縲∵ｼ｢蟄嶺ｸ譁�ｭ暦ｼ� */
.status-ailments {
    display: flex;
    justify-content: center;
    gap: 3px;
    margin-top: 4px;
    height: 20px;
}

.status-ailment {
    font-size: 11px;
    font-weight: 700;
    padding: 2px 5px;
    border-radius: 4px;
    background: rgba(245, 175, 25, 0.9);
    color: #000;
}

/* Command Area */
#command-area {
    background: rgba(20, 20, 30, 0.9);
    border-top: 1px solid var(--glass-border);
    backdrop-filter: blur(20px);
    border-radius: 20px 20px 0 0;
    padding: 8px 16px max(12px, env(safe-area-inset-bottom));
    /* 上下余白を圧縮しつつセーフエリアを確保 */
    margin: 0 -16px 0 -16px;
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
    z-index: 10;
    flex-shrink: 0;
}

#character-commands {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    /* 隙間を半分に */
    background: rgba(0, 0, 0, 0.3);
    padding: 4px 8px;
    /* 縦パディングを圧縮 */
    border-radius: 12px;
}

.char-command-slot {
    font-size: 11px;
    flex: 1;
    text-align: center;
    padding: 6px;
    border-radius: 8px;
    opacity: 0.5;
    transition: 0.3s;
}

.char-command-slot.active {
    opacity: 1;
    background: rgba(255, 255, 255, 0.1);
    color: var(--primary);
    font-weight: 700;
}

#action-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: repeat(3, auto);
    gap: 8px;
}

.action-btn {
    background: linear-gradient(145deg, rgba(50, 60, 80, 0.9), rgba(30, 35, 45, 0.9));
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #fff;
    padding: 8px 12px;
    /* 縦を大幅に細く、横は余裕を持たせる */
    border-radius: 10px;
    font-weight: 700;
    font-size: 14px;
    /* 文字サイズを維持 */
    cursor: pointer;
    transition: 0.2s;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    position: relative;
    overflow: hidden;
}

.action-btn:hover {
    background: linear-gradient(145deg, rgba(70, 80, 100, 0.9), rgba(40, 45, 55, 0.9));
    border-color: var(--primary);
    box-shadow: 0 0 15px rgba(79, 172, 254, 0.3);
    transform: translateY(-2px);
}

.action-btn:active {
    transform: scale(0.96);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.action-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    filter: grayscale(100%);
    box-shadow: none;
    pointer-events: none;
}


/* Turn Execution Controls */
#execute-turn-btn {
    background: linear-gradient(135deg, #FF512F 0%, #DD2476 100%);
    color: #fff;
    font-weight: bold;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    visibility: hidden;
    /* 予約スペースを確保しつつ隠す */
}

.btn-prominent {
    animation: pulse-glow 1s infinite alternate;
    box-shadow: 0 0 15px rgba(255, 81, 47, 0.8) !important;
    border: 2px solid #fff !important;
    transform: scale(1.05);
}

@keyframes pulse-glow {
    from {
        box-shadow: 0 0 10px rgba(255, 81, 47, 0.6);
    }

    to {
        box-shadow: 0 0 25px rgba(255, 81, 47, 1);
    }
}

.faded-out {
    opacity: 0.3;
    pointer-events: none;
    filter: grayscale(100%);
    transition: 0.3s;
}

/* Event & Reward Screen Layout Fixes */
#reward-screen,
#rest-screen,
#event-screen,
#treasure-screen,
#gameover-screen,
#clear-screen {
    display: none;
    /* Default hidden */
}

#reward-screen.active,
#rest-screen.active,
#event-screen.active,
#treasure-screen.active,
#gameover-screen.active,
#clear-screen.active {
    display: flex !important;
    flex-direction: column;
    justify-content: center;
    /* Center content vertically */
}

/* Modals & Overlays */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    animation: fadeIn 0.3s;
}

.modal-content {
    background: #161824;
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 24px;
    width: 100%;
    max-width: 340px;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    transform: translateY(0);
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        transform: translateY(20px);
        opacity: 0;
    }

    to {
        transform: translateY(0);
        opacity: 1;
    }
}

#modal-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
}

/* Toast */
#toast-container {
    position: fixed;
    top: 20px;
    /* Top aligned */
    left: 50%;
    transform: translateX(-50%);
    z-index: 2000;
    width: 90%;
    max-width: 400px;
    pointer-events: none;
}

.toast {
    background: rgba(22, 24, 36, 0.95);
    border-left: 4px solid var(--primary);
    color: #fff;
    padding: 16px;
    margin-bottom: 10px;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    font-size: 14px;
    animation: slideDownToast 0.3s ease-out;
    display: flex;
    align-items: center;
}

@keyframes slideDownToast {
    from {
        transform: translateY(-20px);
        opacity: 0;
    }

    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Reward & Event Screens */
.reward-option,
.event-btn,
.treasure-btn,
.rest-btn {
    background: var(--bg-panel);
    border: 1px solid var(--glass-border);
    padding: 16px;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s;
    text-align: left;
    margin-bottom: 12px;
}

.reward-option:hover,
.event-btn:hover,
.treasure-btn:hover,
.rest-btn:hover {
    border-color: var(--primary);
    background: rgba(79, 172, 254, 0.1);
}

.reward-title {
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 4px;
}

.reward-desc,
.skill-desc {
    font-size: 12px;
    color: var(--text-sub);
}

/* Animations & Effects */
.damage-popup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 900;
    font-size: 32px;
    color: var(--danger);
    text-shadow: 0 2px 4px #000;
    animation: spring-pop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    z-index: 200;
    pointer-events: none;
    white-space: nowrap;
}

.damage-popup.heal {
    color: var(--success);
    text-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
}

.damage-popup.mp-heal {
    color: #d000ff;
    text-shadow: 0 0 10px rgba(208, 0, 255, 0.5);
}

@keyframes spring-pop {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    40% {
        transform: translate(-50%, -100%) scale(1.2);
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -150%) scale(1.0);
        opacity: 0;
    }
}

@keyframes floatUp {
    0% {
        transform: translateY(0) scale(1);
        opacity: 1;
    }

    100% {
        transform: translateY(-40px) scale(1.2);
        opacity: 0;
    }
}

/* Selection Panels (Target, Skill, Item) */
#target-selection,
#skill-selection,
#item-selection {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #11121d;
    padding: 20px;
    padding-bottom: 80px;
    z-index: 100;
    animation: fadeIn 0.2s;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.target-btn,
.skill-btn,
.item-btn {
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    padding: 14px;
    margin-bottom: 10px;
    border-radius: 12px;
    color: #fff;
    text-align: left;
    cursor: pointer;
}

.target-btn:active,
.skill-btn:active,
.item-btn:active {
    background: rgba(79, 172, 254, 0.2);
}

.btn-cancel {
    background: transparent;
    border: 1px solid #555;
    color: #fff;
    padding: 12px;
    width: 100%;
    border-radius: 12px;
    margin-top: 10px;
}

/* 繧ｹ繧ｭ繝ｫ驕ｸ謚槭�繧ｿ繝ｳ縺ｮ譁ｰ繝ｬ繧､繧｢繧ｦ繝� */
.skill-btn {
    display: flex;
    flex-direction: column;
    gap: 2px;
    /* 名称と説明の間の隙間を詰める */
    padding: 6px 12px;
    /* スキルボタンも縦を大幅に圧縮 */
}

.skill-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-bottom: 2px;
}

.skill-name {
    font-weight: 700;
    font-size: 13px;
    /* わずかに小さくして一行の収まりを良くする */
    color: #fff;
}

.skill-cost {
    font-size: 12px;
    color: var(--primary);
    font-weight: 700;
    background: rgba(79, 172, 254, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    white-space: nowrap;
}

.skill-body {
    width: 100%;
    text-align: left;
}

.skill-desc {
    font-size: 11px;
    color: var(--text-sub);
    white-space: normal;
    line-height: 1.4;
    display: block;
}

/* Character Detail Modal */
.character-detail {
    max-width: 400px;
    max-height: 80vh;
    overflow-y: auto;
}

.detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.close-btn {
    background: none;
    border: none;
    color: var(--text-sub);
    font-size: 28px;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.2s;
}

.close-btn:hover {
    color: var(--text-main);
}

.detail-content {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
}

.detail-image {
    flex-shrink: 0;
}

.detail-image img {
    width: 120px;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid var(--glass-border);
}

.detail-stats {
    flex: 1;
    font-size: 13px;
}

.detail-type {
    color: var(--primary);
    font-weight: 700;
    margin-bottom: 12px;
}

.stat-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
}

.stat-label {
    color: var(--text-sub);
}

.stat-value {
    font-weight: 700;
}

.stat-change {
    color: var(--success);
}

.stat-change.down {
    color: var(--danger);
}

.detail-section {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--glass-border);
}

.detail-section h4 {
    font-size: 14px;
    color: var(--primary);
    margin-bottom: 8px;
}

.skill-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 8px;
}

.skill-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 4px;
}

.skill-item-name {
    font-weight: 700;
    font-size: 13px;
}

.skill-item-cost {
    font-size: 11px;
    color: var(--primary);
}

.skill-item-desc {
    font-size: 11px;
    color: var(--text-sub);
    line-height: 1.4;
}

.status-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.status-tag {
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 6px;
    background: rgba(0, 0, 0, 0.5);
}

.status-tag.buff {
    color: var(--success);
    border: 1px solid var(--success);
}

.status-tag.debuff {
    color: var(--danger);
    border: 1px solid var(--danger);
}

.status-tag.ailment {
    color: var(--warning);
    border: 1px solid var(--warning);
}

/* Item Modal */
.item-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: 0.2s;
}

.item-entry:hover {
    background: rgba(79, 172, 254, 0.1);
    border-color: var(--primary);
}

.item-entry.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.item-entry.disabled:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--glass-border);
}

.item-info {
    flex: 1;
}

.item-name {
    font-weight: 700;
    margin-bottom: 2px;
}

.item-desc {
    font-size: 11px;
    color: var(--text-sub);
}

.item-count {
    font-size: 18px;
    font-weight: 700;
    color: var(--primary);
}

/* Event Screen Styles */
#event-screen {
    background-image: url('img/bg/bg_map.png');
    /* 背景統一 */
    background-size: cover;
    background-position: center;
    padding: 24px;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
    /* コンテンツが多い場合のスクロール */
}

#event-screen.active {
    display: flex;
}

/* Rest Screen Styles */
#rest-screen {
    background-image: url('img/bg/bg_map.png');
    background-size: cover;
    background-position: center;
    padding: 24px;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

#rest-screen.active {
    display: flex;
}

#rest-options {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-top: 32px;
    width: 100%;
}

.rest-btn {
    padding: 20px;
    background: linear-gradient(145deg, rgba(80, 40, 40, 0.9), rgba(45, 25, 25, 0.9));
    border: 1px solid rgba(255, 107, 107, 0.3);
    color: #fff;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: 0.2s;
    width: 100%;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

.rest-btn:hover {
    background: linear-gradient(145deg, rgba(100, 50, 50, 0.9), rgba(55, 30, 30, 0.9));
    border-color: var(--danger);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(255, 107, 107, 0.2);
}

.event-content {
    background: rgba(11, 12, 18, 0.85);
    /* 読みやすさ向上のための背景 */
    padding: 24px;
    border-radius: 12px;
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(5px);
    width: 100%;
    max-width: 400px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

#event-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
    /* ボタン間隔調整 */
    margin-top: 24px;
    width: 100%;
}

.event-btn {
    padding: 16px;
    text-align: left;
    line-height: 1.5;
    background: linear-gradient(145deg, rgba(50, 60, 80, 0.9), rgba(30, 35, 45, 0.9));
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: #fff;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    transition: 0.2s;
    width: 100%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.event-btn:hover {
    background: linear-gradient(145deg, rgba(70, 80, 100, 0.9), rgba(40, 45, 55, 0.9));
    border-color: var(--primary);
    transform: translateX(2px);
    box-shadow: 0 4px 8px rgba(79, 172, 254, 0.2);
}

/* Party Status Bar (Map & Rest) */
.party-status-bar,
#party-status-bar,
#rest-party-status {
    width: 100%;
    margin-bottom: 20px;
}

.members-row {
    display: flex;
    justify-content: center;
    gap: 10px;
    width: 100%;
}

.party-member-status {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px;
    border-radius: 8px;
    border: 1px solid var(--glass-border);
    min-width: 85px;
    max-width: 110px;
    cursor: pointer;
}

.party-member-status img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    margin-bottom: 8px;
    border: 2px solid #fff;
}

.hp-mp-text {
    font-size: 10px;
    color: #eee;
    margin: 2px 0;
    width: 100%;
    text-align: left;
    white-space: nowrap;
    font-weight: 700;
}

/* アクティブユニットの点滅効果 */
.battle-unit.active-unit {
    border-color: var(--warning) !important;
    animation: unit-blink 1.5s infinite alternate ease-in-out;
    box-shadow: 0 0 15px rgba(245, 175, 25, 0.5);
}

@keyframes unit-blink {
    from {
        border-color: var(--primary);
    }

    to {
        border-color: var(--warning);
    }
}

/* ボタンの可視性制御 */
#execute-turn-btn.visible {
    visibility: visible !important;
}

.char-command-slot svg {
    display: block;
    margin: 0 auto;
}

/* === 企業レベル・リッチバトル演出 === */

.vfx-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200px;
    height: 200px;
    pointer-events: none;
    z-index: 150;
    display: flex;
    justify-content: center;
    align-items: center;
    mix-blend-mode: plus-lighter;
    /* 加算合成で発光感を最大化 */
}

/* 行動中の黄色枠：脈動アニメーション付き */
.battle-unit.acting {
    border-color: #ffd700 !important;
    box-shadow: 0 0 15px #ffd700, inset 0 0 10px #ffd700 !important;
    animation: acting-pulse 1s infinite alternate ease-in-out;
    z-index: 50;
}

@keyframes acting-pulse {
    from {
        filter: brightness(1) drop-shadow(0 0 5px #ffd700);
    }

    to {
        filter: brightness(1.3) drop-shadow(0 0 15px #ffd700);
    }
}

/* ダメージポップアップ：キャラ中央＆バネ挙動 */
.damage-popup {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 900;
    font-size: 38px;
    color: #ff4757;
    text-shadow: 2px 2px 0 #000, 0 0 10px rgba(255, 71, 87, 0.5);
    animation: pro-spring-pop 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    z-index: 200;
    pointer-events: none;
}

@keyframes pro-spring-pop {
    0% {
        transform: translate(-50%, 0) scale(0.3);
        opacity: 0;
    }

    20% {
        transform: translate(-50%, -40px) scale(1.3);
        opacity: 1;
    }

    40% {
        transform: translate(-50%, -35px) scale(0.9);
    }

    60% {
        transform: translate(-50%, -38px) scale(1.0);
    }

    100% {
        transform: translate(-50%, -80px);
        opacity: 0;
    }
}

/* 物理：鋭利なプロ斬撃 */
.vfx-slash-pro {
    position: absolute;
    width: 150%;
    height: 8px;
    background: linear-gradient(90deg, transparent 0%, #fff 50%, transparent 100%);
    filter: blur(1px) drop-shadow(0 0 10px #ff6b6b);
    transform: rotate(var(--r)) scaleX(0);
    animation: slash-pro-anim 0.3s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

@keyframes slash-pro-anim {
    0% {
        transform: rotate(var(--r)) scaleX(0) skewX(45deg);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: rotate(var(--r)) scaleX(1.2) skewX(45deg);
        opacity: 0;
    }
}

/* 魔法：SVG魔方陣の回転拡散 */
.vfx-magic-circle-pro {
    position: absolute;
    width: 140px;
    height: 140px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='none' stroke='%234facfe' stroke-width='1' stroke-dasharray='5 2'/%3E%3Ccircle cx='50' cy='50' r='38' fill='none' stroke='%234facfe' stroke-width='2'/%3E%3Cpath d='M50 5 L55 45 L95 50 L55 55 L50 95 L45 55 L5 50 L45 45 Z' fill='%234facfe' opacity='0.3'/%3E%3C/svg%3E") center/contain no-repeat;
    animation: magic-circle-anim 0.7s cubic-bezier(0.19, 1, 0.22, 1) forwards;
}

@keyframes magic-circle-anim {
    0% {
        transform: scale(0.2) rotate(-180deg);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scale(1.3) rotate(0deg);
        opacity: 0;
    }
}

/* ストーンエッジ：不規則な岩の突き上げ */
.vfx-rock-pro {
    position: absolute;
    bottom: 20px;
    width: 40px;
    height: 100px;
    background: #8b5e3c;
    clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
    /* 基本は三角 */
    filter: brightness(var(--b)) drop-shadow(0 0 5px #000);
    transform: translateX(var(--x)) scaleY(0);
    animation: rock-pro-anim 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    animation-delay: var(--d);
}

@keyframes rock-pro-anim {
    0% {
        transform: translateX(var(--x)) scaleY(0);
        opacity: 0;
    }

    20% {
        opacity: 1;
    }

    100% {
        transform: translateX(var(--x)) scaleY(1.4);
        opacity: 0;
    }
}

/* 無量空処：明度反転 */
.void-invert {
    animation: void-flash 0.8s ease-in-out;
}

@keyframes void-flash {
    0% {
        filter: invert(0);
    }

    50% {
        filter: invert(1) hue-rotate(180deg);
    }

    100% {
        filter: invert(0);
    }
}

/* === 味方固有技エフェクト === */

/* 星屑クルージング（唐可可）：星の螺旋オーラ (強化版) */
.vfx-stardust {
    position: absolute;
    width: 220px;
    height: 220px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 223, 0, 0.4) 0%, transparent 70%);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
    animation: stardust-spin 1s ease-out forwards;
}

.vfx-stardust::before,
.vfx-stardust::after {
    content: '★';
    position: absolute;
    font-size: 24px;
    color: #ffd700;
    text-shadow: 0 0 10px #ffeb3b, 0 0 20px #fff;
    animation: stardust-orbit 0.8s ease-out forwards;
}

.vfx-stardust::before {
    top: 10%;
    left: 50%;
}

.vfx-stardust::after {
    top: 50%;
    left: 10%;
    font-size: 18px;
    animation-delay: 0.1s;
}

@keyframes stardust-spin {
    0% {
        transform: scale(0.3) rotate(0deg);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scale(2.5) rotate(180deg);
        opacity: 0;
    }
}

@keyframes stardust-orbit {
    0% {
        transform: translateY(0) scale(0.5);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: translateY(-40px) scale(1.5);
        opacity: 0;
    }
}

/* スカイパンチ（キュアスカイ）：青い拳衝撃波 (強化版) */
.vfx-sky-punch {
    position: absolute;
    width: 180px;
    height: 180px;
    background: radial-gradient(circle, rgba(135, 206, 250, 0.9) 0%, rgba(30, 144, 255, 0.4) 60%, transparent 80%);
    border-radius: 50%;
    filter: drop-shadow(0 0 20px #00bfff);
    animation: sky-punch-anim 0.5s cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
}

.vfx-sky-punch::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 140%;
    height: 140%;
    transform: translate(-50%, -50%);
    border: 8px solid rgba(135, 206, 250, 0.8);
    border-radius: 50%;
    box-shadow: 0 0 30px rgba(0, 191, 255, 0.6);
    animation: sky-ring-expand 0.5s cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
}

@keyframes sky-punch-anim {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scale(3);
        opacity: 0;
    }
}

@keyframes sky-ring-expand {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(2.5);
        opacity: 0;
    }
}

/* クレイジー・D（東方仗助）：緑の回復オーラ (強化版) */
.vfx-crazy-diamond {
    position: absolute;
    width: 220px;
    height: 220px;
    background: radial-gradient(circle, rgba(50, 205, 50, 0.4) 0%, transparent 70%);
    border-radius: 50%;
    filter: drop-shadow(0 0 15px #32cd32);
    animation: heal-pulse 0.8s ease-out forwards;
}

.vfx-crazy-diamond::before {
    content: '♥';
    /* ハートマークを使用するが、これは記号として一般的なので許容範囲か確認。
       もし記号禁止ならSVGかCSSシェイプにする必要がある。
       ユーザー要望「絵文字禁止」だが、記号フォントはグレーゾーン。
       安全策としてCSSでハートを作る */
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 50px;
    height: 50px;
    background: #ff69b4;
    transform: translate(-50%, -50%) rotate(-45deg);
    box-shadow: -10px 10px 20px rgba(255, 105, 180, 0.5);
    animation: heal-heart-pop 0.6s ease-out forwards;
}

.vfx-crazy-diamond::after {
    /* ハートの片割れ（擬似要素でハート作成） */
    content: '';
    position: absolute;
    top: 50%;
    /* 調整必要 */
    left: 50%;
}

/* CSS Heart Logic (簡易版) */
/* 以前のSVGによるDiamond設定を上書き */
.vfx-crazy-diamond::before {
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2332cd32' d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E") center/contain no-repeat;
    width: 100px;
    height: 100px;
    transform: translate(-50%, -50%);
    box-shadow: none;
    animation: heal-heart-pop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes heal-heart-pop {
    0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }

    50% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(1.0);
        opacity: 0;
    }
}

/* 堕天龍鳳凰縛（津島善子）：紫の鎖エフェクト */
.vfx-fallen-bind {
    position: absolute;
    width: 200px;
    height: 200px;
}

.vfx-chain {
    position: absolute;
    width: 100%;
    height: 10px;
    background: linear-gradient(90deg, transparent, #9b59b6, transparent);
    filter: drop-shadow(0 0 12px #9b59b6);
    animation: chain-wrap 0.6s ease-out forwards;
}

.vfx-chain:nth-child(1) {
    top: 30%;
    transform: rotate(0deg);
}

.vfx-chain:nth-child(2) {
    top: 50%;
    transform: rotate(15deg);
    animation-delay: 0.1s;
}

.vfx-chain:nth-child(3) {
    top: 70%;
    transform: rotate(-15deg);
    animation-delay: 0.2s;
}

@keyframes chain-wrap {
    0% {
        transform: scaleX(0);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    70% {
        transform: scaleX(1.4);
        opacity: 1;
    }

    100% {
        transform: scaleX(1.2);
        opacity: 0;
    }
}

/* はどうだん（ルカリオ）：青い波動球 */
.vfx-aura-sphere {
    position: absolute;
    width: 120px;
    height: 120px;
    background: radial-gradient(circle, #4facfe 0%, #00f2fe 30%, transparent 70%);
    border-radius: 50%;
    filter: drop-shadow(0 0 25px #4facfe);
    animation: aura-sphere-anim 0.5s ease-out forwards;
}

.vfx-aura-sphere::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120%;
    height: 120%;
    transform: translate(-50%, -50%);
    border: 4px solid rgba(79, 172, 254, 0.5);
    border-radius: 50%;
    animation: aura-ring 0.5s ease-out forwards;
}

@keyframes aura-sphere-anim {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scale(2.5);
        opacity: 0;
    }
}

@keyframes aura-ring {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    30% {
        opacity: 0.8;
    }

    100% {
        transform: translate(-50%, -50%) scale(2.5);
        opacity: 0;
    }
}

/* スカーレットストーム（優木せつ菜）：赤い炎の渦 */
.vfx-scarlet-storm {
    position: absolute;
    width: 240px;
    height: 240px;
    background: radial-gradient(circle, rgba(255, 50, 50, 0.5) 0%, transparent 70%);
    filter: drop-shadow(0 0 20px #ff4500);
    animation: scarlet-spin 0.7s ease-out forwards;
}

.vfx-flame {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 35px;
    height: 70px;
    background: linear-gradient(to top, #ff4500, #ff8c00, transparent);
    border-radius: 50% 50% 50% 50% / 70% 70% 30% 30%;
    filter: blur(2px);
    transform-origin: bottom center;
    animation: flame-dance 0.4s ease-out forwards;
}

.vfx-flame:nth-child(1) {
    transform: translate(-50%, -100%) rotate(0deg);
}

.vfx-flame:nth-child(2) {
    transform: translate(-50%, -100%) rotate(72deg);
    animation-delay: 0.05s;
}

.vfx-flame:nth-child(3) {
    transform: translate(-50%, -100%) rotate(144deg);
    animation-delay: 0.1s;
}

.vfx-flame:nth-child(4) {
    transform: translate(-50%, -100%) rotate(216deg);
    animation-delay: 0.15s;
}

.vfx-flame:nth-child(5) {
    transform: translate(-50%, -100%) rotate(288deg);
    animation-delay: 0.2s;
}

@keyframes scarlet-spin {
    0% {
        transform: scale(0.3) rotate(0deg);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scale(2.0) rotate(180deg);
        opacity: 0;
    }
}

@keyframes flame-dance {
    0% {
        transform: translate(-50%, -100%) scale(0.5);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -100%) scale(2.0) translateY(-40px);
        opacity: 0;
    }
}

/* フュージョンクラスト（セラス）：白い光柱 (強化版) */
.vfx-fusion-crust {
    position: absolute;
    width: 120px;
    height: 400px;
    background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.8), transparent);
    filter: drop-shadow(0 0 30px #fff) drop-shadow(0 0 60px #87ceeb);
    animation: light-pillar 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    mix-blend-mode: overlay;
}

@keyframes light-pillar {
    0% {
        transform: scaleY(0);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scaleY(1.8);
        opacity: 0;
    }
}

/* ドシャット（黒尾鉄朗）：オレンジの盾 (強化版) */
.vfx-doshatto {
    position: absolute;
    width: 200px;
    height: 220px;
    border: 8px solid #f39c12;
    border-radius: 10px 10px 50% 50%;
    background: linear-gradient(135deg, rgba(243, 156, 18, 0.4), rgba(255, 200, 50, 0.1));
    box-shadow: 0 0 20px #f39c12, inset 0 0 20px #f39c12;
    animation: shield-appear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

.vfx-doshatto::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 80px;
    height: 80px;
    transform: translate(-50%, -50%);
    border: 4px solid #fff;
    border-radius: 50%;
    opacity: 0.6;
}

@keyframes shield-appear {
    0% {
        transform: scale(0.5);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    70% {
        transform: scale(1.2);
    }

    100% {
        transform: scale(1.1);
        opacity: 0;
    }
}

/* デロリエラン（若菜四季）：水色のMP回復波 (強化版) */
.vfx-delorieran {
    position: absolute;
    width: 260px;
    height: 260px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(0, 191, 255, 0.3) 0%, transparent 60%);
    filter: drop-shadow(0 0 15px #00bfff);
    animation: mp-wave 1s ease-out forwards;
}

.vfx-delorieran::before,
.vfx-delorieran::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 4px solid rgba(0, 191, 255, 0.8);
    border-radius: 50%;
    box-shadow: 0 0 10px #00bfff;
    animation: mp-ring 1s ease-out forwards;
}

.vfx-delorieran::before {
    width: 60%;
    height: 60%;
}

.vfx-delorieran::after {
    width: 80%;
    height: 80%;
    animation-delay: 0.1s;
}

@keyframes mp-wave {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scale(2.0);
        opacity: 0;
    }
}

@keyframes mp-ring {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    30% {
        opacity: 0.8;
    }

    100% {
        transform: translate(-50%, -50%) scale(2.0);
        opacity: 0;
    }
}

/* 穿天氷壁（轟焦凍）：青い氷柱群 */
.vfx-ice-wall {
    position: absolute;
    width: 220px;
    height: 160px;
}

.vfx-ice-pillar {
    position: absolute;
    bottom: 0;
    width: 40px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(135, 206, 235, 0.8) 50%, rgba(0, 191, 255, 0.6) 100%);
    clip-path: polygon(50% 0%, 80% 20%, 100% 100%, 0% 100%, 20% 20%);
    border-top: 2px solid rgba(255, 255, 255, 0.8);
    filter: drop-shadow(0 0 10px #00bfff);
    animation: ice-rise 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.vfx-ice-pillar:nth-child(1) {
    left: 0%;
    height: 100px;
    animation-delay: 0s;
}

.vfx-ice-pillar:nth-child(2) {
    left: 20%;
    height: 140px;
    animation-delay: 0.05s;
}

.vfx-ice-pillar:nth-child(3) {
    left: 40%;
    height: 180px;
    animation-delay: 0.1s;
}

.vfx-ice-pillar:nth-child(4) {
    left: 60%;
    height: 140px;
    animation-delay: 0.15s;
}

.vfx-ice-pillar:nth-child(5) {
    left: 80%;
    height: 100px;
    animation-delay: 0.2s;
}

@keyframes ice-rise {
    0% {
        transform: scaleY(0);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scaleY(1.2);
        opacity: 0;
    }
}

/* 雷切（カカシ）：黄色い雷撃 */
.vfx-raikiri {
    position: absolute;
    width: 220px;
    height: 220px;
}

.vfx-lightning {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 6px;
    height: 140px;
    background: linear-gradient(to bottom, #dbeeff, #4facfe, transparent);
    filter: drop-shadow(0 0 15px #4facfe) drop-shadow(0 0 30px #00f2fe);
    transform-origin: top center;
    animation: lightning-strike 0.25s ease-out forwards;
}

.vfx-lightning:nth-child(1) {
    transform: translate(-50%, -50%) rotate(-25deg);
}

.vfx-lightning:nth-child(2) {
    transform: translate(-50%, -50%) rotate(25deg);
    animation-delay: 0.05s;
}

.vfx-lightning:nth-child(3) {
    transform: translate(-50%, -50%) rotate(0deg);
    width: 8px;
    /* 中央は太く */
    height: 160px;
    animation-delay: 0.1s;
}

.vfx-lightning::after {
    content: '';
    position: absolute;
    top: 90%;
    left: 50%;
    width: 140%;
    height: 70%;
    transform: translateX(-50%) rotate(40deg);
    background: inherit;
    filter: inherit;
    clip-path: polygon(40% 0, 60% 0, 100% 100%, 0 100%);
}

@keyframes lightning-strike {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scaleY(0);
    }

    20% {
        opacity: 1;
    }

    50% {
        opacity: 1;
        transform: translate(-50%, -50%) scaleY(1.5);
    }

    100% {
        opacity: 0;
    }
}

/* 抹消（相澤消太）：赤い目の光+束縛 */
.vfx-erasure {
    position: absolute;
    width: 200px;
    height: 140px;
}

.vfx-erasure-eye {
    position: absolute;
    top: 30%;
    width: 40px;
    height: 20px;
    background: radial-gradient(ellipse, #ff0000, transparent);
    border-radius: 50%;
    filter: drop-shadow(0 0 25px #ff0000);
    animation: erasure-glow 0.6s ease-out forwards;
}

.vfx-erasure-eye:nth-child(1) {
    left: 25%;
}

.vfx-erasure-eye:nth-child(2) {
    left: 55%;
}

.vfx-erasure-band {
    position: absolute;
    top: 70%;
    left: 0;
    width: 100%;
    height: 12px;
    background: linear-gradient(90deg, transparent, #aaa, transparent);
    animation: erasure-wrap 0.5s ease-out forwards;
}

@keyframes erasure-glow {
    0% {
        opacity: 0;
        transform: scale(0.5);
    }

    30% {
        opacity: 1;
        transform: scale(1.4);
    }

    70% {
        opacity: 1;
    }

    100% {
        opacity: 0;
    }
}

@keyframes erasure-wrap {
    0% {
        transform: scaleX(0);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scaleX(1.2);
        opacity: 0;
    }
}

/* Solitude Rain（桜坂しずく）：紫の雨エフェクト (強化版) */
.vfx-solitude-rain {
    position: absolute;
    width: 240px;
    height: 280px;
    overflow: visible;
}

.vfx-raindrop {
    position: absolute;
    top: -50px;
    width: 3px;
    height: 60px;
    background: linear-gradient(to bottom, transparent, #a29bfe, #fff);
    filter: drop-shadow(0 0 5px #a29bfe);
    animation: rain-fall 0.5s linear infinite;
}

.vfx-raindrop:nth-child(1) {
    left: 15%;
    animation-delay: 0s;
}

.vfx-raindrop:nth-child(2) {
    left: 30%;
    animation-delay: 0.1s;
}

.vfx-raindrop:nth-child(3) {
    left: 45%;
    animation-delay: 0.2s;
}

.vfx-raindrop:nth-child(4) {
    left: 60%;
    animation-delay: 0.05s;
}

.vfx-raindrop:nth-child(5) {
    left: 75%;
    animation-delay: 0.25s;
}

.vfx-raindrop:nth-child(6) {
    left: 90%;
    animation-delay: 0.15s;
}

@keyframes rain-fall {
    to {
        transform: translateY(300px);
        opacity: 0;
    }
}


/* === ボス固有技エフェクト === */

/* バイキンパンチ（ばいきんまん）：紫の拳衝撃 */
.vfx-baikin-punch {
    position: absolute;
    width: 180px;
    height: 180px;
    background: radial-gradient(circle, rgba(128, 0, 128, 0.7) 0%, transparent 60%);
    border-radius: 50%;
    animation: baikin-impact 0.5s ease-out forwards;
}

.vfx-baikin-punch::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200%;
    height: 200%;
    transform: translate(-50%, -50%);
    border: 8px solid rgba(128, 0, 128, 0.5);
    border-radius: 50%;
    animation: baikin-ring 0.5s ease-out forwards;
}

@keyframes baikin-impact {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scale(3.0);
        opacity: 0;
    }
}

@keyframes baikin-ring {
    0% {
        transform: translate(-50%, -50%) scale(0.3);
        opacity: 0;
    }

    30% {
        opacity: 0.8;
    }

    100% {
        transform: translate(-50%, -50%) scale(2.0);
        opacity: 0;
    }
}

/* 毒液噴射（ギギネブラ）：緑の毒霧 */
.vfx-poison-spray {
    position: absolute;
    width: 300px;
    height: 210px;
}

.vfx-poison-cloud {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(50, 205, 50, 0.6), transparent);
    filter: blur(5px);
    animation: poison-expand 0.7s ease-out forwards;
}

.vfx-poison-cloud:nth-child(1) {
    width: 120px;
    height: 90px;
    top: 20%;
    left: 10%;
}

.vfx-poison-cloud:nth-child(2) {
    width: 150px;
    height: 100px;
    top: 30%;
    left: 40%;
    animation-delay: 0.1s;
}

.vfx-poison-cloud:nth-child(3) {
    width: 100px;
    height: 80px;
    top: 50%;
    left: 60%;
    animation-delay: 0.2s;
}

@keyframes poison-expand {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }

    30% {
        opacity: 0.8;
    }

    100% {
        transform: scale(2.0);
        opacity: 0;
    }
}

/* 草薙の剣（大蛇丸）：緑の蛇エフェクト */
.vfx-kusanagi {
    position: absolute;
    width: 240px;
    height: 120px;
}

.vfx-snake {
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    height: 24px;
    background: linear-gradient(90deg, #228b22, #32cd32, #228b22);
    filter: drop-shadow(0 0 15px #32cd32);
    border-radius: 50%;
    animation: snake-slither 0.5s ease-out forwards;
}

.vfx-snake::before {
    content: '';
    position: absolute;
    right: -15px;
    top: 50%;
    transform: translateY(-50%);
    border-left: 20px solid #32cd32;
    border-top: 10px solid transparent;
    border-bottom: 10px solid transparent;
}

@keyframes snake-slither {
    0% {
        transform: translateX(-100%) scaleX(0.5);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: translateX(50%) scaleX(1);
        opacity: 0;
    }
}

/* 呪霊操術（夏油傑）：黒い呪霊シルエット */
.vfx-cursed-spirit {
    position: absolute;
    width: 160px;
    height: 180px;
    background: radial-gradient(ellipse, rgba(0, 0, 0, 0.8) 30%, transparent 70%);
    filter: drop-shadow(0 0 25px #000);
    animation: spirit-manifest 0.6s ease-out forwards;
}

.vfx-cursed-spirit::before {
    content: '';
    position: absolute;
    top: 20%;
    left: 30%;
    width: 25px;
    height: 25px;
    background: #ff0000;
    border-radius: 50%;
    filter: drop-shadow(0 0 15px #ff0000);
}

.vfx-cursed-spirit::after {
    content: '';
    position: absolute;
    top: 20%;
    right: 30%;
    width: 25px;
    height: 25px;
    background: #ff0000;
    border-radius: 50%;
    filter: drop-shadow(0 0 15px #ff0000);
}

@keyframes spirit-manifest {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    70% {
        transform: scale(1.2);
    }

    100% {
        transform: scale(1.1);
        opacity: 0;
    }
}

/* デスボール（フリーザ）：赤黒い球体 */
.vfx-death-ball {
    position: absolute;
    width: 160px;
    height: 160px;
    background: radial-gradient(circle, #ff0000 0%, #800000 40%, #000 70%);
    border-radius: 50%;
    filter: drop-shadow(0 0 40px #ff0000);
    animation: death-ball-anim 0.7s ease-out forwards;
}

.vfx-death-ball::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 150%;
    height: 150%;
    transform: translate(-50%, -50%);
    border: 5px solid rgba(255, 0, 0, 0.5);
    border-radius: 50%;
    animation: death-ring 0.7s ease-out forwards;
}

@keyframes death-ball-anim {
    0% {
        transform: scale(0.2);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scale(2.5);
        opacity: 0;
    }
}

@keyframes death-ring {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    30% {
        opacity: 0.6;
    }

    100% {
        transform: translate(-50%, -50%) scale(3.0);
        opacity: 0;
    }
}

/* ザ・ワールド（ディオ）：時計+黄金の時止め */
.vfx-za-warudo {
    position: absolute;
    width: 240px;
    height: 240px;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.3) 0%, transparent 70%);
    animation: time-stop 0.8s ease-out forwards;
}

.vfx-za-warudo::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120px;
    height: 120px;
    transform: translate(-50%, -50%);
    border: 6px solid #ffd700;
    border-radius: 50%;
    filter: drop-shadow(0 0 20px #ffd700);
}

.vfx-za-warudo::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 6px;
    height: 50px;
    background: #ffd700;
    transform-origin: bottom center;
    transform: translate(-50%, -100%);
    animation: clock-hand 0.8s ease-out forwards;
}

@keyframes time-stop {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    60% {
        transform: scale(1.2);
    }

    100% {
        transform: scale(1);
        opacity: 0;
    }
}

@keyframes clock-hand {
    0% {
        transform: translate(-50%, -100%) rotate(0deg);
    }

    100% {
        transform: translate(-50%, -100%) rotate(360deg);
    }
}

/* 鏡花水月（愛染惣右介）：鏡のような反射 */
.vfx-kyoka-suigetsu {
    position: absolute;
    width: 200px;
    height: 260px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(200, 200, 255, 0.2), rgba(255, 255, 255, 0.3));
    border: 3px solid rgba(255, 255, 255, 0.5);
    border-radius: 10px;
    filter: drop-shadow(0 0 25px rgba(200, 200, 255, 0.5));
    animation: mirror-shimmer 0.7s ease-out forwards;
}

.vfx-kyoka-suigetsu::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.4) 50%, transparent 60%);
    animation: mirror-shine 0.5s ease-out forwards;
}

@keyframes mirror-shimmer {
    0% {
        transform: scale(0.5) rotateY(90deg);
        opacity: 0;
    }

    30% {
        opacity: 1;
        transform: scale(1) rotateY(0deg);
    }

    100% {
        transform: scale(1.2) rotateY(-10deg);
        opacity: 0;
    }
}

@keyframes mirror-shine {
    0% {
        transform: translateX(-100%);
    }

    100% {
        transform: translateX(100%);
    }
}

/* フォトンゲイザー（ネクロズマ）：光の柱 */
.vfx-photon-geyser {
    position: absolute;
    width: 140px;
    height: 400px;
    background: linear-gradient(to top, transparent, rgba(255, 255, 200, 0.9), #fff, rgba(255, 255, 200, 0.9), transparent);
    filter: blur(4px) drop-shadow(0 0 40px #ffd700);
    animation: photon-burst 0.6s ease-out forwards;
}

@keyframes photon-burst {
    0% {
        transform: scaleY(0);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scaleY(1);
        opacity: 0;
    }
}

/* グランドスラム（マスターハンド）：白い手形衝撃 */
.vfx-grand-slam {
    position: absolute;
    width: 220px;
    height: 260px;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 120'%3E%3Cpath fill='white' d='M50 10 L60 50 L90 60 L60 70 L50 110 L40 70 L10 60 L40 50 Z'/%3E%3C/svg%3E") center/contain no-repeat;
    filter: drop-shadow(0 0 30px #fff);
    animation: slam-impact 0.5s ease-out forwards;
}

@keyframes slam-impact {
    0% {
        transform: scale(0.3) translateY(-50px);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    50% {
        transform: scale(1.3) translateY(0);
    }

    100% {
        transform: scale(1.8) translateY(10px);
        opacity: 0;
    }
}

/* 崩壊（死柄木弔）：ひび割れ演出 */
.vfx-decay {
    position: absolute;
    width: 240px;
    height: 240px;
}

.vfx-crack {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 90px;
    background: linear-gradient(to bottom, #888, #444);
    transform-origin: top center;
    animation: crack-spread 0.4s ease-out forwards;
}

.vfx-crack:nth-child(1) {
    transform: translate(-50%, 0) rotate(0deg);
}

.vfx-crack:nth-child(2) {
    transform: translate(-50%, 0) rotate(45deg);
    animation-delay: 0.05s;
}

.vfx-crack:nth-child(3) {
    transform: translate(-50%, 0) rotate(90deg);
    animation-delay: 0.1s;
}

.vfx-crack:nth-child(4) {
    transform: translate(-50%, 0) rotate(135deg);
    animation-delay: 0.15s;
}

.vfx-crack:nth-child(5) {
    transform: translate(-50%, 0) rotate(180deg);
    animation-delay: 0.2s;
}

.vfx-crack:nth-child(6) {
    transform: translate(-50%, 0) rotate(225deg);
    animation-delay: 0.25s;
}

.vfx-crack:nth-child(7) {
    transform: translate(-50%, 0) rotate(270deg);
    animation-delay: 0.3s;
}

.vfx-crack:nth-child(8) {
    transform: translate(-50%, 0) rotate(315deg);
    animation-delay: 0.35s;
}

@keyframes crack-spread {
    0% {
        transform: translate(-50%, 0) scaleY(0);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, 0) scaleY(1);
        opacity: 0;
    }
}

/* クッパブレス（クッパ）：オレンジの炎 */
.vfx-koopa-breath {
    position: absolute;
    width: 180px;
    height: 100px;
}

.vfx-fire-stream {
    position: absolute;
    top: 40%;
    left: 0;
    width: 100%;
    height: 40px;
    background: linear-gradient(90deg, #ff6b00, #ffa500, #ffcc00, transparent);
    border-radius: 50% 100% 100% 50%;
    filter: blur(3px) drop-shadow(0 0 20px #ff6b00);
    animation: fire-breath 0.6s ease-out forwards;
}

.vfx-fire-stream::before,
.vfx-fire-stream::after {
    content: '';
    position: absolute;
    left: 0;
    width: 80%;
    height: 20px;
    background: linear-gradient(90deg, #ff6b00, #ffa500, transparent);
    border-radius: 50%;
    filter: blur(2px);
    animation: fire-wave 0.5s ease-out forwards;
}

.vfx-fire-stream::before {
    top: -15px;
}

.vfx-fire-stream::after {
    bottom: -15px;
    animation-delay: 0.1s;
}

@keyframes fire-breath {
    0% {
        transform: scaleX(0);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    100% {
        transform: scaleX(1.2);
        opacity: 0;
    }
}

@keyframes fire-wave {
    0% {
        transform: scaleX(0);
        opacity: 0;
    }

    30% {
        opacity: 0.8;
    }

    100% {
        transform: scaleX(1);
        opacity: 0;
    }
}

/* シールドオーラ（防御・バフ系共通） */
.shield-aura {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 130%;
    height: 130%;
    border: 4px solid #ffd700;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
    filter: drop-shadow(0 0 15px #ffd700);
    animation: shield-pulse 0.8s ease-out forwards;
    pointer-events: none;
    z-index: 100;
}

@keyframes shield-pulse {
    0% {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 0;
    }

    30% {
        opacity: 1;
    }

    70% {
        transform: translate(-50%, -50%) scale(1.1);
    }

    100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
    }
}

/* フラッシュエフェクト（色違い追加） */
.flash-gold {
    animation: flash-gold-anim 0.3s ease-out;
}

@keyframes flash-gold-anim {
    0% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(2) drop-shadow(0 0 20px #ffd700);
    }

    100% {
        filter: brightness(1);
    }
}

.flash-purple {
    animation: flash-purple-anim 0.3s ease-out;
}

@keyframes flash-purple-anim {
    0% {
        filter: brightness(1);
    }

    50% {
        filter: brightness(1.5) drop-shadow(0 0 20px #9b59b6);
    }

    100% {
        filter: brightness(1);
    }
}